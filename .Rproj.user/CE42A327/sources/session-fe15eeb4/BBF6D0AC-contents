#' Find Maximum Value of K for a Poisson Tail Probability
#'
#' Computes the smallest integer \code{Kmax} such that the upper tail probability
#' of a Poisson distribution with parameter \code{lambda} is less than or equal to
#' a specified threshold \code{epsilon}.
#'
#' @param lambda Numeric. The rate parameter of the Poisson distribution.
#' @param epsilon Numeric. A small positive threshold for the tail probability (default is 1e-6).
#'
#' @return Integer. The smallest \code{Kmax} such that \code{P(X > Kmax) <= epsilon}.
#'
#' @examples
#' find_Kmax(5)           # Typical usage with default epsilon
#' find_Kmax(10, 1e-8)    # With a stricter tail threshold
#'
#' @export
#'

find_Kmax <- function(lambda, epsilon = 1e-6) {
  Kmax <- 0
  tail_prob <- 1 - stats::ppois(Kmax, lambda)

  while (tail_prob > epsilon) {
    Kmax <- Kmax + 1
    tail_prob <- 1 - stats::ppois(Kmax, lambda)
  }

  return(Kmax)
}
