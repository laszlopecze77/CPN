#' Summary Method for Compound Poisson-Normal Regression Models
#'
#' Provides a detailed summary of a fitted \code{cpn} model, including estimated
#' coefficients, standard errors, z-values, p-values, deviance residuals, and
#' model fit statistics (AIC, deviance).
#'
#' @param object An object of class \code{"cpn"} returned by the \code{\link{cpn}} function.
#' @param ... Additional arguments (currently unused).
#'
#' @return Invisibly returns a data frame with estimated coefficients, standard errors,
#' z-values, and p-values.
#'
#' @details
#' This method extracts parameter estimates from a fitted Compound Poisson-Normal regression
#' model and computes inferential statistics (z-scores and p-values) for the Poisson regression
#' coefficients. It also reports the estimated parameters for the normal component (\code{mu} and \code{sigma}),
#' a summary of deviance residuals, and fit statistics such as null and residual deviance and the AIC.
#'
#' @seealso \code{\link{cpn}}
#' @importFrom stats pnorm printCoefmat quantile
#' @export
summary.cpn <- function(object, ...) {
  # Separate mu and sigma from coefficients
  beta_hat <- object$coefficients
  se_hat <- object$se[1:length(beta_hat)]

  # z-values and p-values for coefficients only
  z_vals <- beta_hat / se_hat
  p_vals <- 2 * stats::pnorm(-abs(z_vals))

  param_names <- names(beta_hat)

  summary_table <- data.frame(
    Estimate = beta_hat,
    Std.Error = se_hat,
    z.value = z_vals,
    Pr.z = p_vals,
    row.names = param_names
  )

  # Deviance residuals summary
  dev_res <- object$deviance_residuals
  dev_summary <- stats::quantile(dev_res, probs = c(0, 0.25, 0.5, 0.75, 1))
  names(dev_summary) <- c("Min", "1Q", "Median", "3Q", "Max")

  cat("Call:\n")
  print(object$call)

  cat("\nDeviance Residuals:\n")
  print(dev_summary, digits = 4, quote = FALSE)

  cat("\nCoefficients:\n")
  printCoefmat(summary_table, P.values = TRUE, has.Pvalue = TRUE)

  # Print mu and sigma separately
  cat(sprintf("\nEstimated mu parameter: %.4f\n", object$mu))
  cat(sprintf("Estimated sigma parameter: %.4f\n", object$sigma))

  # Deviance summary
  cat(sprintf("\nNull deviance: %.2f on %d degrees of freedom\n",
              object$null_deviance, object$df_null))
  cat(sprintf("Residual deviance: %.2f on %d degrees of freedom\n",
              object$residual_deviance, object$df_residual))
  cat(sprintf("AIC: %.2f\n", object$aic))

  invisible(summary_table)
}
