<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Compound Poisson-Normal Regression ‚Ä¢ CPN</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compound Poisson-Normal Regression">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CPN</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CPN-vignette.html">Compound Poisson-Normal Regression</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compound Poisson-Normal Regression</h1>
                        <h4 data-toc-skip class="author">Laszlo
Pecze</h4>
            
            <h4 data-toc-skip class="date">2025-06-16</h4>
      

      <div class="d-none name"><code>CPN-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In many applied settings‚Äîincluding insurance claims, biological
systems, and environmental monitoring‚Äîthe observed data arise from a
random number of additive events, where each event contributes a
continuous value. A natural model for such data is the <strong>Compound
Poisson-Normal (CPN)</strong> distribution.</p>
<p>The CPN model assumes that the number of events follows a Poisson
distribution, and that each event contributes an independent and
identically distributed (i.i.d.) <strong>normally distributed</strong>
amount.</p>
<p>Formally, let:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>‚àº</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N \sim \text{Poisson}(\lambda)</annotation></semantics></math>
denote the number of events,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>1</mn></msub><mo>,</mo><msub><mi>X</mi><mn>2</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>X</mi><mi>N</mi></msub><mover><mo>‚àº</mo><mtext mathvariant="normal">i.i.d.</mtext></mover><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œº</mi><mo>,</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X_1, X_2, \ldots, X_N \overset{\text{i.i.d.}}{\sim} \mathcal{N}(\mu, \sigma^2)</annotation></semantics></math>,
independent of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>,</li>
</ul>
<p>Then the total observed outcome is modeled as a <strong>compound
sum</strong>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>X</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">
Y = \sum_{i=1}^{N} X_i
</annotation></semantics></math></p>
<p>The resulting distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is known as the <strong>Compound Poisson-Normal
distribution</strong>.</p>
<p>The first two moments of the CPN distribution are:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>Œª</mi><mi>Œº</mi><mo>,</mo><mspace width="1.0em"></mspace><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Œª</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>Œº</mi><mn>2</mn></msup><mo>+</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathbb{E}[Y] = \lambda \mu,\quad \text{Var}(Y) = \lambda (\mu^2 + \sigma^2)
</annotation></semantics></math></p>
<p>These follow from the properties of the compound distribution,
combining Poisson and Gaussian contributions. The (approximate)
probability density function (pdf) of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>Y</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>;</mo><mi>Œª</mi><mo>,</mo><mi>Œº</mi><mo>,</mo><mi>œÉ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msup><mi>e</mi><mrow><mo>‚àí</mo><mi>Œª</mi></mrow></msup><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mi>y</mi><mo>=</mo><mn>0</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><munderover><mo>‚àë</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>K</mi><mtext mathvariant="normal">max</mtext></msub></munderover><mfrac><mrow><msup><mi>e</mi><mrow><mo>‚àí</mo><mi>Œª</mi></mrow></msup><msup><mi>Œª</mi><mi>k</mi></msup></mrow><mrow><mi>k</mi><mi>!</mi></mrow></mfrac><mo>‚ãÖ</mo><mfrac><mn>1</mn><msqrt><mrow><mn>2</mn><mi>œÄ</mi><mi>k</mi><msup><mi>œÉ</mi><mn>2</mn></msup></mrow></msqrt></mfrac><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>‚àí</mo><mi>k</mi><mi>Œº</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><mi>k</mi><msup><mi>œÉ</mi><mn>2</mn></msup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mi>y</mi><mo>‚â†</mo><mn>0</mn></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
f_Y(y; \lambda, \mu, \sigma) =
\begin{cases}
e^{-\lambda}, &amp; \text{if } y = 0 \\\\
\sum_{k=1}^{K_{\text{max}}} \frac{e^{-\lambda} \lambda^k}{k!} \cdot \frac{1}{\sqrt{2\pi k \sigma^2}} \exp\left( -\frac{(y - k\mu)^2}{2k\sigma^2} \right), &amp; \text{if } y \neq 0
\end{cases}
</annotation></semantics></math></p>
<p><strong>Where:</strong></p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>:
the observed total from the compound process<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>:
expected number of Poisson events<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>:
mean of each normal component<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÉ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>:
standard deviation of each normal component<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>:
number of events (from 1 to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mtext mathvariant="normal">max</mtext></msub><annotation encoding="application/x-tex">K_{\text{max}}</annotation></semantics></math>)<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mtext mathvariant="normal">max</mtext></msub><annotation encoding="application/x-tex">K_{\text{max}}</annotation></semantics></math>:
maximum number of events used in the approximation</li>
</ul>
<p>When
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k = 0</annotation></semantics></math>,
the sum is defined as a point mass at zero, and its probability is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>e</mi><mrow><mo>‚àí</mo><mi>Œª</mi></mrow></msup></mrow><annotation encoding="application/x-tex">
P(Y = 0) = P(N = 0) = e^{-\lambda}
</annotation></semantics></math></p>
<p>In theory, the compound distribution sums over an infinite range of
possible Poisson event counts. In practice, this sum must be
<strong>truncated</strong> at a finite maximum value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mo>max</mo></msub><annotation encoding="application/x-tex">K_{\max}</annotation></semantics></math>,
chosen so that the remaining tail probability is negligible.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>To use the function, load the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://laszlopecze77.github.io/CPN/">CPN</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-data">Simulating Data<a class="anchor" aria-label="anchor" href="#simulating-data"></a>
</h2>
<p>We‚Äôll simulate a dataset that mimics typical CPN behavior. This
includes both categorical and continuous predictors, and outcomes
generated via a Poisson count of normally distributed values.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_cpn_data.html">simulate_cpn_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#            y x1          x2</span></span>
<span><span class="co"># 1 -0.5703738  A  0.25331851</span></span>
<span><span class="co"># 2  0.0000000  A -0.02854676</span></span>
<span><span class="co"># 3  0.9613621  A -0.04287046</span></span>
<span><span class="co"># 4  5.3350483  B  1.36860228</span></span>
<span><span class="co"># 5  3.1328607  A -0.22577099</span></span>
<span><span class="co"># 6 -2.6186645  B  1.51647060</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-the-simulated-data">Plot the simulated data<a class="anchor" aria-label="anchor" href="#plot-the-simulated-data"></a>
</h2>
<p>Visualize the response y against predictor x2, colored by group
x1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scatter plot of y vs x1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/stripchart.html" class="external-link">stripchart</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  vertical <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="st">"jitter"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,  <span class="st">"red"</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"x1"</span>, ylab <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Scatter Plot of y by x1"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="CPN-vignette_files/figure-html/simuplot-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="fit-the-cpn-model">Fit the CPN Model<a class="anchor" aria-label="anchor" href="#fit-the-cpn-model"></a>
</h2>
<p>Fit a Compound Poisson-Normal regression model to the data using a
standard formula interface. The response variable y is modeled as a
function of predictors x1 (categorical) and x2 (continuous).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cpn.html">cpn</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summary-of-results">Summary of Results<a class="anchor" aria-label="anchor" href="#summary-of-results"></a>
</h2>
<p>Get a summary of the fitted model, including coefficient estimates,
standard errors, z-values, and p-values. The summary also includes
estimates of the mu and sigma parameters (mean and SD of the normal
component) and model fit statistics like AIC.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># cpn(formula = y ~ x1 + x2, data = data)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Deviance Residuals:</span></span>
<span><span class="co">#    Min     1Q Median     3Q    Max </span></span>
<span><span class="co"># -2.871 -2.059 -1.269  2.181  3.745 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Coefficients:</span></span>
<span><span class="co">#             Estimate Std.Error z.value      Pr.z    </span></span>
<span><span class="co"># (Intercept)  0.63754   0.15190  4.1969 2.705e-05 ***</span></span>
<span><span class="co"># x1B         -0.60713   0.22934 -2.6473  0.008114 ** </span></span>
<span><span class="co"># x2           0.53609   0.10791  4.9679 6.767e-07 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Estimated mu parameter: 0.9600</span></span>
<span><span class="co"># Estimated sigma parameter: 1.7062</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Null deviance: 478.20 on 99 degrees of freedom</span></span>
<span><span class="co"># Residual deviance: 449.74 on 95 degrees of freedom</span></span>
<span><span class="co"># AIC: 459.74</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extracting-model-components">Extracting Model Components<a class="anchor" aria-label="anchor" href="#extracting-model-components"></a>
</h2>
<p>You can directly access key components of the fitted model
object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="co"># (Intercept)         x1B          x2 </span></span>
<span><span class="co">#   0.6375359  -0.6071284   0.5360923</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">mu</span></span>
<span><span class="co">#        mu </span></span>
<span><span class="co"># 0.9599623</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">sigma</span></span>
<span><span class="co">#    sigma </span></span>
<span><span class="co"># 1.706243</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">fitted_values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>  <span class="co"># preview only</span></span>
<span><span class="co">#  [1] 2.0802264 1.7884887 1.7748077 2.0611074 1.6090445 2.2311441 0.4313962</span></span>
<span><span class="co">#  [8] 1.3538511 1.9407450 2.0389587</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="coefficients-and-interpretation">Coefficients and Interpretation<a class="anchor" aria-label="anchor" href="#coefficients-and-interpretation"></a>
</h2>
<p>Use coef() to extract model coefficients. Setting full = FALSE shows
only the linear predictor coefficients (excluding auxiliary parameters
like mu and sigma).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co"># (Intercept)         x1B          x2          mu       sigma </span></span>
<span><span class="co">#   0.6375359  -0.6071284   0.5360923   0.9599623   1.7062428</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span>, full <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># Includes only linear predictors</span></span>
<span><span class="co"># (Intercept)         x1B          x2 </span></span>
<span><span class="co">#   0.6375359  -0.6071284   0.5360923</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="diagnostics-and-residuals">Diagnostics and Residuals<a class="anchor" aria-label="anchor" href="#diagnostics-and-residuals"></a>
</h2>
<p>Basic diagnostic plots and residuals help check model fit and detect
issues like non-linearity or outliers.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="CPN-vignette_files/figure-html/diagnostics-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#  [1] -2.215482 -1.930328 -1.997946  2.411580  2.145066 -2.766042  2.737024</span></span>
<span><span class="co">#  [8]  2.297386 -2.398468 -2.008626</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="likelihood-and-information-criteria">Likelihood and Information Criteria<a class="anchor" aria-label="anchor" href="#likelihood-and-information-criteria"></a>
</h2>
<p>These metrics are useful for comparing model fit.
<code><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik()</a></code> gives the log-likelihood, <code><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC()</a></code> the
Akaike Information Criterion (lower is better), and <code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code>
returns the variance-covariance matrix of the parameters.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co"># 'log Lik.' -224.8705 (df=5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co"># [1] 459.741</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#              (Intercept)          x1B           x2           mu        sigma</span></span>
<span><span class="co"># (Intercept)  0.023075014 -0.018395473 -0.002512385 -0.010214396 -0.007321724</span></span>
<span><span class="co"># x1B         -0.018395473  0.052596614  0.000287386  0.002777711 -0.001478573</span></span>
<span><span class="co"># x2          -0.002512385  0.000287386  0.011644724 -0.002747529 -0.001565976</span></span>
<span><span class="co"># mu          -0.010214396  0.002777711 -0.002747529  0.027438819  0.008114203</span></span>
<span><span class="co"># sigma       -0.007321724 -0.001478573 -0.001565976  0.008114203  0.033661888</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="type-i-analysis-of-deviance">Type I Analysis of Deviance<a class="anchor" aria-label="anchor" href="#type-i-analysis-of-deviance"></a>
</h2>
<p>The function <code>anova(fit)</code> provides a sequential (Type I)
analysis of deviance.<br>
This examines the incremental contribution of each predictor to the
model‚Äôs fit, based on the order in which they appear in the formula.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#       Term     Df Deviance Resid. Df Resid. Dev   Pr(&gt;Chi) Signif</span></span>
<span><span class="co">#  Residuals                        97      478.2                  </span></span>
<span><span class="co">#         x1      1   6.7993        96      471.4  0.0091193     **</span></span>
<span><span class="co">#         x2      1   21.657        95     449.74 3.2607e-06    ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-update-and-comparison">Model Update and Comparison<a class="anchor" aria-label="anchor" href="#model-update-and-comparison"></a>
</h2>
<p>You can update a model (e.g., remove predictors) and compare nested
models using the likelihood ratio test:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">x2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">fit2</span><span class="op">)</span>  <span class="co"># Likelihood ratio test</span></span>
<span><span class="co">#    Model Resid. Df Resid. Dev     Df Deviance   Pr(&gt;Chi) Signif</span></span>
<span><span class="co">#  Model 1        95     449.74                                  </span></span>
<span><span class="co">#  Model 2        96      471.4      1   21.657 3.2607e-06    ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h2>
<p>Once you have fitted a Compound Poisson-Normal (CPN) regression model
using the <code><a href="../reference/cpn.html">cpn()</a></code> function, you can generate predictions on
both the <strong>original data</strong> and <strong>new
observations</strong> using the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method for
<code>cpn</code> objects.</p>
<p>This method supports three prediction types:</p>
<ul>
<li>
<strong>‚Äúlink‚Äù</strong>: Returns the linear predictor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ∑</mi><mo>=</mo><mi>X</mi><mi>Œ≤</mi></mrow><annotation encoding="application/x-tex">\eta = X\beta</annotation></semantics></math>.</li>
<li>
<strong>‚Äúrate‚Äù</strong>: Returns the rate component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ∑</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(\eta)</annotation></semantics></math>,
representing the expected number of latent events.</li>
<li>
<strong>‚Äúresponse‚Äù</strong>: Returns the expected response
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>Œº</mi><mo>‚ãÖ</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ∑</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[Y] = \mu \cdot \exp(\eta)</annotation></semantics></math>,
combining the frequency and magnitude components of the compound
distribution.</li>
</ul>
<p>Additionally, confidence intervals can be requested using the
<code>interval = "confidence"</code> argument, which computes
approximate <strong>normal-theory confidence intervals</strong> using
the <strong>delta method</strong>.</p>
<div class="section level3">
<h3 id="predicting-on-the-original-data">Predicting on the Original Data<a class="anchor" aria-label="anchor" href="#predicting-on-the-original-data"></a>
</h3>
<p>By default, <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> uses the original dataset used for
model fitting. You can obtain point estimates or confidence intervals
for the fitted values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Point predictions on the response scale</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co"># [1] 2.080226 1.788489 1.774808 2.061107 1.609045</span></span>
<span></span>
<span><span class="co"># Confidence intervals for response predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"response"</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#        fit       lwr      upr</span></span>
<span><span class="co"># 1 2.080226 1.1475902 3.012863</span></span>
<span><span class="co"># 2 1.788489 0.9814659 2.595511</span></span>
<span><span class="co"># 3 1.774808 0.9733248 2.576291</span></span>
<span><span class="co"># 4 2.061107 0.8876666 3.234548</span></span>
<span><span class="co"># 5 1.609045 0.8722838 2.345805</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predicting-on-new-data">Predicting on New Data<a class="anchor" aria-label="anchor" href="#predicting-on-new-data"></a>
</h3>
<p>To make predictions on new data, provide a <code>data.frame</code> to
the <code>newdata</code> argument. The function will internally align
factor levels and construct the appropriate model matrix.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define new observations</span></span>
<span><span class="va">new_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predictions on the link scale (linear predictor Œ∑)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">new_df</span>, type <span class="op">=</span> <span class="st">"link"</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span>
<span><span class="co">#          fit         lwr       upr</span></span>
<span><span class="co"># 1  0.3694897  0.03861794 0.7003615</span></span>
<span><span class="co"># 2  0.5303174  0.22324817 0.8373866</span></span>
<span><span class="co"># 3 -0.1304202 -0.52855693 0.2677165</span></span>
<span><span class="co"># 4 -0.1304202 -0.52855693 0.2677165</span></span>
<span></span>
<span><span class="co"># Predictions on the rate scale (exp(Œ∑))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">new_df</span>, type <span class="op">=</span> <span class="st">"rate"</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span>
<span><span class="co">#         fit      lwr      upr</span></span>
<span><span class="co"># 1 1.4469960 1.039373 2.014481</span></span>
<span><span class="co"># 2 1.6994716 1.250131 2.310321</span></span>
<span><span class="co"># 3 0.8777265 0.589455 1.306976</span></span>
<span><span class="co"># 4 0.8777265 0.589455 1.306976</span></span>
<span></span>
<span><span class="co"># Predictions on the response scale (Œº √ó exp(Œ∑))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">new_df</span>, type <span class="op">=</span> <span class="st">"response"</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span>
<span><span class="co">#         fit       lwr      upr</span></span>
<span><span class="co"># 1 1.3890617 0.7318477 2.046276</span></span>
<span><span class="co"># 2 1.6314287 0.8861812 2.376676</span></span>
<span><span class="co"># 3 0.8425844 0.4024248 1.282744</span></span>
<span><span class="co"># 4 0.8425844 0.4024248 1.282744</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="confidence-intervals">Confidence Intervals<a class="anchor" aria-label="anchor" href="#confidence-intervals"></a>
</h3>
<p>When <code>interval = "confidence"</code> is used:</p>
<ul>
<li>On the <strong>link</strong> and <strong>rate</strong> scales,
confidence intervals are based solely on the uncertainty in the
regression coefficients
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>).</li>
<li>On the <strong>response</strong> scale, the intervals additionally
incorporate uncertainty in the mean magnitude parameter
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>)
using the <strong>delta method</strong>:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">SE</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>Œº</mi><mo>‚ãÖ</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ∑</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>‚âà</mo><msqrt><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œº</mi><mo>‚ãÖ</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ∑</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>‚ãÖ</mo><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>Œ∑</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ∑</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>‚ãÖ</mo><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>Œº</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">
\text{SE}[\mu \cdot \exp(\eta)] \approx \sqrt{(\mu \cdot \exp(\eta))^2 \cdot \text{Var}[\eta] + (\exp(\eta))^2 \cdot \text{Var}[\mu]}
</annotation></semantics></math></p>
<p>This provides a more accurate reflection of total uncertainty when
predicting expected values of the compound outcome.</p>
<p>```</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>CPN</code> package enables effective modeling of
semicontinuous data using the Compound Poisson-Normal model. It supports
flexible model specification, S3 methods for diagnostics and inference,
and prediction on new data. For more advanced use, refer to the function
documentation or the package reference manual.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Nascimento2019" class="csl-entry">
D. C. Nascimento, Abra√£o, Leandro C. R√™go, and Raphaela L. B. A.
Nascimento. 2019. <span>‚ÄúCompound Truncated Poisson Normal Distribution:
Mathematical Properties and Moment Estimation.‚Äù</span> <em>Inverse
Problems &amp;Amp; Imaging</em> 13 (4): 787‚Äì803. <a href="https://doi.org/10.3934/ipi.2019036" class="external-link">https://doi.org/10.3934/ipi.2019036</a>.
</div>
<div id="ref-hu2024" class="csl-entry">
Hu, Haoran, Xinjun Wang, Site Feng, Zhongli Xu, Jing Liu, Elisa
Heidrich-O‚ÄôHare, Yanshuo Chen, et al. 2024. <span>‚ÄúA Unified Model-Based
Framework for Doublet or Multiplet Detection in Single-Cell Multiomics
Data.‚Äù</span> <em>Nature Communications</em> 15 (1): 5562.
</div>
<div id="ref-raqab2021" class="csl-entry">
Raqab, Mohammad Z, Debasis Kundu, and Fahimah A Al-Awadhi. 2021.
<span>‚ÄúCompound Zero-Truncated Poisson Normal Distribution and Its
Applications.‚Äù</span> <em>Communications in Statistics-Theory and
Methods</em> 50 (13): 3030‚Äì50.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laszlo Pecze.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
